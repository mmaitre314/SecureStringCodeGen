{"name":"Secure-String Code Generator","tagline":"Store sensitive strings like API keys and connection strings out of source control","body":"[![Build status](https://ci.appveyor.com/api/projects/status/s08qgb4egku0pa3d?svg=true)](https://ci.appveyor.com/project/mmaitre314/securestringcodegen)\r\n\r\nThe client-side equivalent of Azure's web.config/app.config setting override. It avoids leaking confidential information like API keys and connection strings in open-source code repositories.\r\n\r\nOn the server side\r\n---\r\n\r\nOn the server side there is already [an](http://azure.microsoft.com/blog/2013/07/17/windows-azure-web-sites-how-application-strings-and-connection-strings-work/) [effective](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure) [solution](http://typecastexception.com/post/2014/04/06/ASPNET-MVC-Keep-Private-Settings-Out-of-Source-Control.aspx) to avoid checking in sensitive strings: Azure overrides settings in app.config and web.config files with values specified in the Azure portal. \r\n\r\n![Azure settings](http://mmaitre314.github.io/SecureStringCodeGen/AzureSettings.PNG)\r\n\r\nSo a config file can be checked in with connection strings pointing to a local test server for initial testing:\r\n       \r\n```xml\r\n<configuration>\r\n  <connectionStrings>\r\n    <add name=\"AzureWebJobsStorage\" connectionString=\"UseDevelopmentStorage=true;DevelopmentStorageProxyUri=http://127.0.0.1;\" />\r\n  </connectionStrings>\r\n  <appSettings>\r\n    <add key=\"MS_MicrosoftClientID\" value=\"Overridden by portal settings\" />\r\n    <add key=\"MS_MicrosoftClientSecret\" value=\"Overridden by portal settings\" />\r\n  </appSettings>\r\n</configuration>\r\n```\r\n\r\nLater on during publication to the cloud those strings get replaced by new ones pointing to production servers:\r\n\r\n```xml\r\n<configuration>\r\n  <connectionStrings>\r\n    <add name=\"AzureWebJobsStorage\" connectionString=\"DefaultEndpointsProtocol=https;AccountName=someaccountname;AccountKey=somelongstring\" />\r\n  </connectionStrings>\r\n  <appSettings>\r\n    <add key=\"MS_MicrosoftClientID\" value=\"0000000012345678\" />\r\n    <add key=\"MS_MicrosoftClientSecret\" value=\"anotherlongstring\" />\r\n  </appSettings>\r\n</configuration>\r\n```\r\n\r\nOn the client side\r\n---\r\n\r\nThings don't work so well on the client side, especially for Universal Windows/Windows Phone Store apps which do not even support app.config files.\r\n\r\nThe AppVeyor CI build server provides the first half of a solution: like Azure, sensitive strings can be [specified](http://www.appveyor.com/docs/build-configuration#secure-variables) in its portal.\r\n\r\n![AppVeyor settings](http://mmaitre314.github.io/SecureStringCodeGen/AppVeyorSettings.PNG)\r\n\r\nThey can also be provided as encrypted strings in checked-in YAML config files:\r\n\r\n```yaml\r\nenvironment:\r\n  Property2:\r\n    secure: F175Fzw/JJX3Kfc2gOkyCQr3ObuViwce+k3qOQQDd2Q=\r\n  Property3:\r\n    secure: 0jMqSEZxjEdWE2qLPcuR2SznHEZhbtB7heqbN/eIh3M=\r\n```\r\n\r\nThe build server then sets those values as environment variables during the build process. \r\n\r\nWhat is missing is something which takes those environment variables and makes them available to app code during compilation. This is what this project is about.\r\n\r\nSecure-string code generation\r\n---\r\n\r\nTo get started, install the [MMaitre.SecureStringCodeGen](https://www.nuget.org/packages/MMaitre.SecureStringCodeGen/) NuGet package, add a couple of XML files to the VS project as decribed below, and build. The NuGet package adds an MSBuild target to the Visual Studio project which generates C# code during the build process. \r\n\r\nFollowing Azure's model, settings are split into two XML files, one which is checked in and one which is not. The one checked in (with .stx extension, as in \"Settings Template XML\") contains a list of keys, along with an optional set of non-sensitive values.\r\n\r\n```xml\r\n<settings override=\"GlobalSettings.sox\" >\r\n  <set key=\"Property1\" value=\"value1\"/>\r\n  <set key=\"Property2\" />\r\n</settings>\r\n```\r\n\r\nThe one kept out of source control (with .sox extension, as in \"Settings Override XML\") contains sensitive strings to be used during dev builds on local machines.\r\n\r\n```xml\r\n<settings>\r\n  <set key=\"Property1\" value=\"valueA\"/>\r\n  <set key=\"Property2\" value=\"valueB\"/>\r\n</settings>\r\n```\r\n\r\nThose sensitive strings are also provided to AppVeyor via portal/YAML.\r\n\r\nDuring the build, the XML files and environment variables are transformed into C# classes which the app can use just like regular code:\r\n\r\n```c#\r\ninternal static class GlobalSettings\r\n{\r\n    public const String Property1 = \"valueA\";\r\n    public const String Property2 = \"valueB\";\r\n}\r\n```\r\n\r\nThe names of the classes match the names of the .stx files.\r\n\r\nThere are a couple of caveats in that process worth mentioning:\r\n\r\n1. C# classes are generated during the build process and changes to the .stx/.sox config files and to registry keys are not immediately reflected in Intellisense.\r\n2. Strings are not obfuscated in binaries, so attackers can recover them via decompilation or even Notepad. This project only avoids storing those strings in source control.\r\n\r\nFurther reading\r\n---\r\n\r\nFor more info about how the code works, see [this blog](http://mmaitre314.github.io/2014/12/25/secure-string-code-generator-a-breakdown.html).\r\n\r\nIf you are interested in improving code generation, [T4 templates](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx) are an option worth looking into. Here they were an overkill bringing in [heavy dependencies](http://msdn.microsoft.com/en-us/library/ee847423.aspx) (the whole Modeling SDK), but are in general quite powerful.\r\n\r\nAnother potential improvement would be replacing the PowerShell script implementing code generation by [MSBuild tasks](http://www.codeproject.com/Articles/42853/Strongly-typed-AppSettings-with-MSBuild). MSBuild takes quite some time to spin up PowerShell processes during the build.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}